<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solomiya: Learn Ukrainian</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* --- DESIGN SYSTEM & RESET --- */
        :root {
            --primary-color: #0057B7;
            --secondary-color: #FFD700;
            --background-color: #F8F9FA;
            --surface-color: #FFFFFF;
            --text-color: #212529;
            --text-light-color: #6c757d;
            --success-color: #28A745;
            --error-color: #DC3545;
            --border-color: #DEE2E6;
            --shadow-color: rgba(0, 0, 0, 0.1);

            --font-header: 'Montserrat', sans-serif;
            --font-body: 'Open Sans', sans-serif;
            --font-ukrainian: 'Roboto', sans-serif;
            --font-mono: 'Courier New', monospace;

            --header-height: 70px;
            --sidebar-width: 250px;
            --sidebar-width-collapsed: 80px;
        }

        [data-theme="dark"] {
            --background-color: #121212;
            --surface-color: #1E1E1E;
            --text-color: #E0E0E0;
            --text-light-color: #A0A0A0;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            display: flex;
        }

        #app-container {
            display: flex;
            width: 100%;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-header);
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }
        
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.75rem; }

        p { margin-bottom: 1rem; }
        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        a:hover { color: var(--secondary-color); }

        .ukrainian-text {
            font-family: var(--font-ukrainian);
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .ipa-text {
            font-family: var(--font-mono);
            color: var(--text-light-color);
        }

        /* --- LAYOUT --- */
        #main-sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--surface-color);
            border-right: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
        }
        
        #main-sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
            align-items: center;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        .sidebar-header .logo-text { font-size: 1.5rem; font-weight: bold; }
        .sidebar-header .logo-icon { font-size: 2rem; }
        #main-sidebar.collapsed .logo-text { display: none; }
        #main-sidebar:not(.collapsed) .logo-icon { display: none; }

        #sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .main-nav {
            flex-grow: 1;
        }
        .main-nav ul { list-style: none; }
        .main-nav li { margin-bottom: 0.5rem; }
        .main-nav a {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
        }
        .main-nav a:hover, .main-nav a.active {
            background-color: var(--primary-color);
            color: white;
        }
        .main-nav a .nav-icon { font-size: 1.5rem; margin-right: 1rem; }
        #main-sidebar.collapsed .nav-text { display: none; }
        #main-sidebar.collapsed .nav-icon { margin-right: 0; }
        #main-sidebar.collapsed a { justify-content: center; }

        .sidebar-footer {
            padding: 1rem 0;
            text-align: center;
        }
        
        #main-content {
            flex-grow: 1;
            padding: 2rem;
            max-width: calc(100vw - var(--sidebar-width));
        }
        #main-sidebar.collapsed + #main-content {
            max-width: calc(100vw - var(--sidebar-width-collapsed));
        }

        #top-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1.5rem;
        }
        
        .streak-counter, .xp-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            padding: 0.5rem 1rem;
            background: var(--surface-color);
            border-radius: 20px;
        }
        .streak-counter .icon, .xp-badge .icon { font-size: 1.5rem; }
        .streak-counter .icon { color: #FF9800; }
        .xp-badge .icon { color: var(--secondary-color); }

        .user-profile-menu .menu-toggle {
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .user-profile-menu .dropdown-menu {
            display: none;
            position: absolute;
            right: 2rem;
            top: 6rem;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            z-index: 1000;
            min-width: 200px;
        }
        .user-profile-menu.open .dropdown-menu { display: block; }
        .dropdown-menu ul { list-style: none; }
        .dropdown-menu a, .dropdown-menu .menu-item {
            display: block;
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
         .dropdown-menu a:hover, .dropdown-menu .menu-item:hover {
            background-color: var(--background-color);
        }

        /* --- COMPONENTS --- */
        .card {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px var(--shadow-color);
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
        }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #00418c; }
        .btn-secondary { background-color: var(--secondary-color); color: var(--text-color); }
        .btn-secondary:hover { background-color: #e6c300; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-error { background-color: var(--error-color); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); }
        .btn-outline:hover { background: var(--primary-color); color: white; }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar-inner {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }
        
        /* Specific page styles */
        #page-home .welcome-header { text-align: center; margin-bottom: 2rem;}
        #page-home .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;}
        
        #page-lessons .level-selector { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        #page-lessons .level-selector .level-card {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            border: 2px solid var(--border-color);
        }
        #page-lessons .level-selector .level-card.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .module-card {
            display: flex;
            flex-direction: column;
        }
        .module-card .module-content {
            flex-grow: 1;
        }
        .module-card .module-footer {
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Lesson View */
        #lesson-view .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        #lesson-view .lesson-content {
            font-size: 1.1rem;
        }
        #lesson-view .lesson-nav {
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
        }

        /* Flashcards */
        #flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 2rem auto;
        }
        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--surface-color);
        }
        .flashcard-back {
            transform: rotateY(180deg);
        }
        .flashcard-word {
            font-size: 2.5rem;
        }
        .flashcard-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        
        /* --- RESPONSIVENESS --- */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 0px;
                --sidebar-width-collapsed: 0px;
            }
            #main-sidebar {
                position: fixed;
                left: -300px;
                top: 0;
                height: 100%;
                z-index: 2000;
                transition: left 0.3s ease;
            }
            #main-sidebar.open {
                left: 0;
                width: 250px;
            }
            #main-content {
                max-width: 100vw;
                padding: 1rem;
            }
            .mobile-menu-toggle {
                display: block !important;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 2001;
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 50%;
                width: 40px;
                height: 40px;
            }
            #top-header {
                justify-content: flex-end;
            }
        }
        .loading-spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <div id="app-container">
        <!-- Sidebar -->
        <aside id="main-sidebar">
            <div class="sidebar-header">
                <span class="logo-text">Solomiya</span>
                <span class="logo-icon">üá∫üá¶</span>
            </div>
            
            <button id="sidebar-toggle" title="Toggle Sidebar">‚Äπ</button>

            <nav class="main-nav">
                <ul>
                    <li><a href="#" data-page="home" class="nav-link active"><span class="nav-icon">üè†</span> <span class="nav-text">Home</span></a></li>
                    <li><a href="#" data-page="lessons" class="nav-link"><span class="nav-icon">üìö</span> <span class="nav-text">Lessons</span></a></li>
                    <li><a href="#" data-page="practice" class="nav-link"><span class="nav-icon">‚úèÔ∏è</span> <span class="nav-text">Practice</span></a></li>
                    <li><a href="#" data-page="community" class="nav-link"><span class="nav-icon">üë•</span> <span class="nav-text">Community</span></a></li>
                    <li><a href="#" data-page="progress" class="nav-link"><span class="nav-icon">üìä</span> <span class="nav-text">Progress</span></a></li>
                    <li><a href="#" data-page="resources" class="nav-link"><span class="nav-icon">üí°</span> <span class="nav-text">Resources</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div id="dark-mode-toggle" class="menu-item">
                    <label class="d-flex align-center justify-between">
                        <span class="nav-text">Dark Mode</span>
                        <input type="checkbox" id="dark-mode-checkbox">
                    </label>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content">
            <button class="mobile-menu-toggle hidden" id="mobile-menu-btn">‚ò∞</button>
            <header id="top-header">
                <div class="streak-counter">
                    <span class="icon">üî•</span>
                    <span id="streak-value">0</span>
                </div>
                <div class="xp-badge">
                    <span class="icon">‚≠ê</span>
                    <span id="xp-value">0</span> XP
                </div>
                <div class="user-profile-menu">
                    <div class="menu-toggle" id="user-profile-toggle">U</div>
                    <div class="dropdown-menu">
                         <ul>
                            <li><a href="#" data-page="progress">My Progress</a></li>
                            <li><a href="#" data-page="settings">Settings</a></li>
                            <li><a href="#" id="logout-btn">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </header>
            
            <div id="page-content">
                <!-- Dynamic content will be injected here -->
            </div>
        </main>
    </div>

    <script>
        const App = {
            // --- CORE PROPERTIES ---
            data: {
                userProfile: null,
                settings: null,
                vocabulary: [],
                progress: null,
                achievements: [],
                studyHistory: [],
                content: {
                    levels: {}, // Populated in content module
                },
                currentPage: 'home',
                currentLevel: 'A1',
            },

            // --- INITIALIZATION ---
            init() {
                console.log("Initializing Solomiya Ukrainian Learning App...");
                this.DOM.cacheDOM();
                this.Content.init();
                this.DataManager.loadAll();
                this.UI.init();
                this.Router.navigateTo(this.data.currentPage, true);
                this.DOM.addEventListeners();
                this.User.checkDailyLogin();
                console.log("App initialized successfully.");
            },

            // --- DOM MANAGEMENT ---
            DOM: {
                els: {},
                cacheDOM() {
                    this.els.appContainer = document.getElementById('app-container');
                    this.els.mainContent = document.getElementById('main-content');
                    this.els.pageContent = document.getElementById('page-content');
                    this.els.sidebar = document.getElementById('main-sidebar');
                    this.els.sidebarToggle = document.getElementById('sidebar-toggle');
                    this.els.navLinks = document.querySelectorAll('.nav-link');
                    this.els.mobileMenuBtn = document.getElementById('mobile-menu-btn');
                    this.els.userProfileToggle = document.getElementById('user-profile-toggle');
                    this.els.userProfileMenu = document.querySelector('.user-profile-menu');
                    this.els.streakValue = document.getElementById('streak-value');
                    this.els.xpValue = document.getElementById('xp-value');
                    this.els.darkModeToggle = document.getElementById('dark-mode-toggle');
                    this.els.darkModeCheckbox = document.getElementById('dark-mode-checkbox');
                },
                addEventListeners() {
                    this.els.sidebarToggle.addEventListener('click', () => this.els.sidebar.classList.toggle('collapsed'));
                    this.els.mobileMenuBtn.addEventListener('click', () => this.els.sidebar.classList.toggle('open'));
                    this.els.userProfileToggle.addEventListener('click', () => this.els.userProfileMenu.classList.toggle('open'));
                    
                    document.addEventListener('click', (e) => {
                        if (!this.els.userProfileMenu.contains(e.target)) {
                            this.els.userProfileMenu.classList.remove('open');
                        }
                    });
                    
                    this.els.navLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            App.Router.navigateTo(e.currentTarget.dataset.page);
                            this.els.sidebar.classList.remove('open');
                        });
                    });
                    
                    this.els.darkModeCheckbox.addEventListener('change', (e) => {
                         App.UI.setTheme(e.target.checked ? 'dark' : 'light');
                    });
                }
            },

            // --- ROUTER ---
            Router: {
                navigateTo(page, isInitial = false) {
                    if (!page || App.data.currentPage === page && !isInitial) return;
                    App.data.currentPage = page;
                    
                    const pageRenderer = App.Pages[page];
                    if (pageRenderer) {
                        App.DOM.els.pageContent.innerHTML = '<div class="loading-spinner"></div>';
                        setTimeout(() => {
                           App.DOM.els.pageContent.innerHTML = pageRenderer.render();
                           if(pageRenderer.init) pageRenderer.init();
                           App.UI.updateActiveNav(page);
                        }, 200);
                    } else {
                        App.DOM.els.pageContent.innerHTML = `<h2>Page not found: ${page}</h2>`;
                    }
                },
            },

            // --- PAGE RENDERERS ---
            Pages: {
                home: {
                    render() {
                        const user = App.data.userProfile;
                        const wordOfTheDay = App.Content.getWordOfTheDay();
                        return `
                            <div id="page-home">
                                <div class="welcome-header">
                                    <h1>–ü—Ä–∏–≤—ñ—Ç, ${user.name}!</h1>
                                    <p>Welcome back! Ready to learn some Ukrainian?</p>
                                </div>
                                <div class="stats-grid">
                                    <div class="card">
                                        <h4>Words Learned</h4>
                                        <p class="ukrainian-text">${App.data.vocabulary.filter(v => v.mastery > 0).length}</p>
                                    </div>
                                    <div class="card">
                                        <h4>Lessons Completed</h4>
                                        <p class="ukrainian-text">${App.data.progress.lessonsCompleted.length}</p>
                                    </div>
                                    <div class="card">
                                        <h4>Current Level</h4>
                                        <p class="ukrainian-text">${user.level}</p>
                                    </div>
                                </div>
                                <div class="card">
                                    <h3>Word of the Day</h3>
                                    <div class="d-flex justify-between align-center">
                                         <div>
                                            <p class="ukrainian-text">${wordOfTheDay.ukrainian}</p>
                                            <p><em>${wordOfTheDay.english}</em></p>
                                         </div>
                                         <button class="btn btn-outline" onclick="App.Audio.speak('${wordOfTheDay.ukrainian}')">üîä</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                },
                lessons: {
                    render() {
                        const levels = Object.keys(App.data.content.levels);
                        let levelSelectorHTML = levels.map(level => `
                            <div class="card level-card ${level === App.data.currentLevel ? 'active' : ''}" onclick="App.Pages.lessons.selectLevel('${level}')">
                                <h3>${level}</h3>
                                <p>${App.data.content.levels[level].name}</p>
                            </div>
                        `).join('');

                        return `
                            <div id="page-lessons">
                                <h2>Lessons</h2>
                                <div class="level-selector">${levelSelectorHTML}</div>
                                <h3 id="module-list-header">Modules for Level ${App.data.currentLevel}</h3>
                                <div class="module-grid" id="module-grid-container">
                                    ${this.renderModules(App.data.currentLevel)}
                                </div>
                            </div>
                        `;
                    },
                    renderModules(level) {
                        const modules = App.data.content.levels[level].modules;
                        return modules.map((mod, index) => `
                            <div class="card module-card">
                                <div class="module-content">
                                    <h4>${mod.title}</h4>
                                    <p>${mod.description}</p>
                                </div>
                                <div class="module-footer">
                                    <div class="progress-bar">
                                        <div class="progress-bar-inner" style="width: ${App.User.getModuleProgress(level, index)}%;"></div>
                                    </div>
                                    <button class="btn btn-primary" onclick="App.Pages.lessons.startLesson('${level}', ${index}, 0)">Start</button>
                                </div>
                            </div>
                        `).join('');
                    },
                    selectLevel(level) {
                        App.data.currentLevel = level;
                        document.getElementById('module-list-header').innerText = `Modules for Level ${level}`;
                        document.getElementById('module-grid-container').innerHTML = this.renderModules(level);
                        document.querySelectorAll('.level-card').forEach(c => c.classList.remove('active'));
                        event.currentTarget.classList.add('active');
                    },
                    startLesson(levelId, moduleId, lessonIndex) {
                        const module = App.data.content.levels[levelId].modules[moduleId];
                        const lesson = module.lessons[lessonIndex];
                        
                        let contentHTML = `
                            <div id="lesson-view">
                                <div class="lesson-header">
                                    <h2>${lesson.title}</h2>
                                    <span>${lessonIndex + 1} / ${module.lessons.length}</span>
                                </div>
                                <div class="progress-bar mb-3">
                                    <div class="progress-bar-inner" style="width: ${((lessonIndex + 1) / module.lessons.length) * 100}%;"></div>
                                </div>
                                <div class="card lesson-content">${lesson.content}</div>
                                <div class="lesson-nav">
                                    ${lessonIndex > 0 ? `<button class="btn btn-outline" onclick="App.Pages.lessons.startLesson('${levelId}', ${moduleId}, ${lessonIndex - 1})">Previous</button>` : '<div></div>'}
                                    ${lessonIndex < module.lessons.length - 1 ? `<button class="btn btn-primary" onclick="App.Pages.lessons.startLesson('${levelId}', ${moduleId}, ${lessonIndex + 1})">Next</button>` : `<button class="btn btn-success" onclick="App.Pages.lessons.finishModule('${levelId}', ${moduleId})">Finish Module</button>`}
                                </div>
                            </div>
                        `;
                        App.DOM.els.pageContent.innerHTML = contentHTML;
                    },
                    finishModule(levelId, moduleId) {
                        App.User.addXP(25);
                        App.User.completeModule(levelId, moduleId);
                        App.UI.showToast("Module completed! +25 XP");
                        this.selectLevel(levelId);
                         App.Router.navigateTo('lessons');
                    }
                },
                practice: {
                    render() {
                        return `
                        <div id="page-practice">
                            <h2>Practice Zone</h2>
                            <div class="module-grid">
                                <div class="card practice-card" onclick="App.Practice.start('flashcards')">
                                    <h4>Flashcards</h4>
                                    <p>Review vocabulary with spaced repetition.</p>
                                </div>
                                <div class="card practice-card" onclick="App.Practice.start('pronunciation')">
                                    <h4>Pronunciation</h4>
                                    <p>Record and compare your pronunciation.</p>
                                </div>
                                <div class="card practice-card" onclick="App.Practice.start('quiz')">
                                    <h4>Vocabulary Quiz</h4>
                                    <p>Test your knowledge with various quiz types.</p>
                                </div>
                            </div>
                        </div>`;
                    }
                },
                community: { render() { return `<h2>Community (Coming Soon)</h2><p>Connect with other learners, find language partners, and join study groups.</p>`; } },
                progress: { render() { return `<h2>My Progress (Coming Soon)</h2><p>Track your learning journey, view achievements, and set goals.</p>`; } },
                resources: { render() { return `<h2>Resources (Coming Soon)</h2><p>Find useful links, grammar tables, and cultural notes.</p>`; } },
                settings: { 
                     render() { 
                         return `<h2>Settings (Coming Soon)</h2><p>Manage your account, preferences, and data.</p>`;
                    }
                },
            },
            
            // --- PRACTICE MODULES ---
            Practice: {
                start(type) {
                    const container = App.DOM.els.pageContent;
                    switch(type) {
                        case 'flashcards':
                            this.Flashcards.start();
                            break;
                        default:
                            container.innerHTML = `<h2>${type} practice is not available yet.</h2>`;
                    }
                },
                
                Flashcards: {
                    currentCard: null,
                    deck: [],
                    
                    start() {
                        this.deck = App.data.vocabulary.slice(0, 10); // Simple deck for now
                        App.DOM.els.pageContent.innerHTML = `
                            <div id="flashcard-practice">
                                <h2>Flashcards</h2>
                                <div id="flashcard-container"></div>
                                <div class="flashcard-actions"></div>
                            </div>
                        `;
                        this.nextCard();
                    },
                    
                    nextCard() {
                        if (this.deck.length === 0) {
                            App.DOM.els.pageContent.innerHTML = `<h2>Practice Complete!</h2><p>You've reviewed all cards for this session.</p><button class="btn btn-primary" onclick="App.Router.navigateTo('practice')">Back to Practice</button>`;
                            return;
                        }
                        this.currentCard = this.deck.pop();
                        this.renderCard();
                    },
                    
                    renderCard() {
                        const cardContainer = document.getElementById('flashcard-container');
                        cardContainer.innerHTML = `
                             <div class="flashcard" onclick="this.classList.toggle('flipped')">
                                <div class="flashcard-face flashcard-front">
                                    <p class="ukrainian-text flashcard-word">${this.currentCard.ukrainian}</p>
                                    <button class="btn btn-outline" onclick="event.stopPropagation(); App.Audio.speak('${this.currentCard.ukrainian}')">üîä</button>
                                </div>
                                <div class="flashcard-face flashcard-back">
                                    <p><strong>${this.currentCard.english}</strong></p>
                                    <p class="ipa-text">[${this.currentCard.ipa}]</p>
                                    <p><em>${this.currentCard.example}</em></p>
                                </div>
                            </div>
                        `;
                        
                        const actionsContainer = document.querySelector('.flashcard-actions');
                        actionsContainer.innerHTML = `
                            <button class="btn btn-error" onclick="App.Practice.Flashcards.handleAnswer(0)">Need Review</button>
                            <button class="btn btn-secondary" onclick="App.Practice.Flashcards.handleAnswer(1)">Learning</button>
                            <button class="btn btn-success" onclick="App.Practice.Flashcards.handleAnswer(2)">Know It</button>
                        `;
                    },
                    
                    handleAnswer(masteryLevel) {
                        // In a real SRS, this would update the card's review schedule
                        this.currentCard.mastery = masteryLevel;
                        App.User.addXP(masteryLevel + 1);
                        this.nextCard();
                    }
                }
            },

            // --- DATA & CONTENT ---
            DataManager: {
                save(key) {
                    try {
                        localStorage.setItem(`solomiya_${key}`, JSON.stringify(App.data[key]));
                    } catch (e) {
                        console.error(`Failed to save ${key}:`, e);
                    }
                },
                load(key) {
                    try {
                        const data = localStorage.getItem(`solomiya_${key}`);
                        return data ? JSON.parse(data) : null;
                    } catch (e) {
                        console.error(`Failed to load ${key}:`, e);
                        return null;
                    }
                },
                loadAll() {
                    const user = this.load('userProfile');
                    if (user) {
                        App.data.userProfile = user;
                        App.data.settings = this.load('settings');
                        App.data.vocabulary = this.load('vocabulary');
                        App.data.progress = this.load('progress');
                        App.data.achievements = this.load('achievements');
                        App.data.studyHistory = this.load('studyHistory');
                    } else {
                        // First time user
                        App.data.userProfile = { name: 'Student', level: 'A1', xp: 0, streak: 0, longestStreak: 0, lastLogin: null, joinDate: new Date().toISOString() };
                        App.data.settings = { theme: 'light', audioAutoplay: true };
                        App.data.vocabulary = App.Content.getInitialVocabulary();
                        App.data.progress = { lessonsCompleted: [], modulesCompleted: {}, quizzesCompleted: [] };
                        App.data.achievements = [];
                        App.data.studyHistory = [];
                        this.saveAll();
                    }
                },
                saveAll() {
                    Object.keys(App.data).forEach(key => {
                        if (key !== 'content') this.save(key);
                    });
                }
            },
            
            Content: {
                init() {
                    this.levels.A1.init();
                    this.levels.A2.init();
                    //... init other levels
                    App.data.content.levels = {
                        A1: { name: "Beginner", modules: this.levels.A1.modules },
                        A2: { name: "Elementary", modules: this.levels.A2.modules },
                        B1: { name: "Intermediate", modules: [] },
                        B2: { name: "Upper-Intermediate", modules: [] },
                        C1: { name: "Advanced", modules: [] },
                        C2: { name: "Mastery", modules: [] },
                    };
                },
                getInitialVocabulary() {
                    // Combine vocab from all initial lessons
                    return [
                        ...this.levels.A1.vocabulary,
                        ...this.levels.A2.vocabulary
                    ].map(v => ({ ...v, mastery: 0, lastReviewed: null, timesCorrect: 0, timesIncorrect: 0 }));
                },
                getWordOfTheDay() {
                    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                    const vocab = App.data.vocabulary;
                    return vocab[dayOfYear % vocab.length];
                },
                
                // --- LEVEL CONTENT ---
                levels: {
                    A1: {
                        modules: [],
                        vocabulary: [],
                        init() {
                            this.vocabulary = [
                                { ukrainian: '–ü—Ä–∏–≤—ñ—Ç', english: 'Hello', ipa: 'pr…™Ààvit', example: '–ü—Ä–∏–≤—ñ—Ç, —è–∫ —Å–ø—Ä–∞–≤–∏?' },
                                { ukrainian: '–î—è–∫—É—é', english: 'Thank you', ipa: 'Ààdjak äj ä', example: '–î—è–∫—É—é –∑–∞ –¥–æ–ø–æ–º–æ–≥—É.' },
                                { ukrainian: '–ë—É–¥—å –ª–∞—Å–∫–∞', english: 'Please / You\'re welcome', ipa: 'bud Ààlaska', example: '–î–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –º–µ–Ω—é.' },
                                { ukrainian: '–¢–∞–∫', english: 'Yes', ipa: 'tak', example: '–¢–∞–∫, —è —Ä–æ–∑—É–º—ñ—é.' },
                                { ukrainian: '–ù—ñ', english: 'No', ipa: 'ni', example: '–ù—ñ, —è –Ω–µ —Ö–æ—á—É.' },
                                { ukrainian: '–º–∞–º–∞', english: 'mother', ipa: 'Ààmama', example: '–ú–æ—è –º–∞–º–∞ —Ç—É—Ç.' },
                                { ukrainian: '—Ç–∞—Ç–æ', english: 'father', ipa: 'Ààtato', example: '–ú—ñ–π —Ç–∞—Ç–æ –ª—ñ–∫–∞—Ä.' },
                            ];
                            this.modules = [
                                {
                                    title: "The Ukrainian Alphabet",
                                    description: "Learn the 33 letters of the beautiful Ukrainian alphabet.",
                                    lessons: [
                                        { title: "Introduction to Cyrillic", content: `<h3>Welcome!</h3><p>The Ukrainian alphabet, called '–∞–ª—Ñ–∞–≤—ñ—Ç' or '–∞–±–µ—Ç–∫–∞', is based on the Cyrillic script. It has 33 letters. Many might look familiar, but some have different sounds. Let's start with the first few.</p>`},
                                        { title: "Vowels", content: `<h4>Vowels (–ì–æ–ª–æ—Å–Ω—ñ)</h4><p>Ukrainian has 10 vowels: <strong>–∞, –µ, —î, –∏, —ñ, —ó, –æ, —É, —é, —è</strong>. They are key to pronunciation!</p>`},
                                        { title: "Consonants", content: `<h4>Consonants (–ü—Ä–∏–≥–æ–ª–æ—Å–Ω—ñ)</h4><p>Let's look at some consonants. <strong>–ë (b), –í (v), –ì (h), “ê (g), –î (d)</strong>. Notice the sound of –ì is like 'h' in 'hello'.</p>`},
                                    ]
                                },
                                {
                                    title: "Basic Greetings",
                                    description: "How to say hello, goodbye, and thank you.",
                                    lessons: [
                                        { title: "Hello and Goodbye", content: `<h3>Greetings</h3><p>The most common informal greeting is <strong class="ukrainian-text">–ü—Ä–∏–≤—ñ—Ç (pryvit)</strong>. For formal situations or saying 'good day', use <strong class="ukrainian-text">–î–æ–±—Ä–∏–π –¥–µ–Ω—å (dobryi den)</strong>.</p><p>To say goodbye, use <strong class="ukrainian-text">–î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è (do pobachennia)</strong>.</p>`},
                                        { title: "Essential Politeness", content: `<h3>Polite Phrases</h3><p>Always use <strong class="ukrainian-text">–î—è–∫—É—é (diakuiu)</strong> for 'Thank you' and <strong class="ukrainian-text">–ë—É–¥—å –ª–∞—Å–∫–∞ (bud laska)</strong> for 'Please' or 'You're welcome'.</p>`},
                                    ]
                                }
                            ];
                        }
                    },
                    A2: {
                        modules: [],
                        vocabulary: [],
                        init() {
                            this.vocabulary = [
                                { ukrainian: '—Ö–ª—ñ–±', english: 'bread', ipa: 'xlib', example: '–Ø –ª—é–±–ª—é —Å–≤—ñ–∂–∏–π —Ö–ª—ñ–±.' },
                                { ukrainian: '–º–æ–ª–æ–∫–æ', english: 'milk', ipa: 'moloÀàko', example: '–î–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –º–æ–ª–æ–∫–æ.' },
                            ];
                             this.modules = [
                                {
                                    title: "Food & Drink",
                                    description: "Learn essential vocabulary for food and ordering at a restaurant.",
                                    lessons: [
                                        { title: "Basic Foods", content: `<h3>Common Foods</h3><p>Let's learn some basic food items. Bread is <strong class="ukrainian-text">—Ö–ª—ñ–± (khlib)</strong>, water is <strong class="ukrainian-text">–≤–æ–¥–∞ (voda)</strong>, and milk is <strong class="ukrainian-text">–º–æ–ª–æ–∫–æ (moloko)</strong>.</p>`},
                                    ]
                                }
                            ];
                        }
                    }
                }
            },
            
            // --- USER & GAMIFICATION ---
            User: {
                addXP(amount) {
                    this.data.userProfile.xp += amount;
                    this.UI.updateHeader();
                    this.DataManager.save('userProfile');
                    // Check for level up
                },
                checkDailyLogin() {
                    const today = new Date().toDateString();
                    const lastLogin = this.data.userProfile.lastLogin;
                    
                    if (today !== lastLogin) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);

                        if (lastLogin === yesterday.toDateString()) {
                            this.data.userProfile.streak++;
                        } else {
                            this.data.userProfile.streak = 1;
                        }
                        
                        this.data.userProfile.lastLogin = today;
                        this.addXP(5); // Daily login bonus
                        App.UI.showToast(`Welcome back! +5 XP. Streak: ${this.data.userProfile.streak} days.`);
                        this.DataManager.save('userProfile');
                    }
                     this.UI.updateHeader();
                },
                completeModule(levelId, moduleId) {
                    if (!this.data.progress.modulesCompleted[levelId]) {
                        this.data.progress.modulesCompleted[levelId] = [];
                    }
                    if (!this.data.progress.modulesCompleted[levelId].includes(moduleId)) {
                        this.data.progress.modulesCompleted[levelId].push(moduleId);
                        this.DataManager.save('progress');
                    }
                },
                getModuleProgress(levelId, moduleId) {
                    // For now, it's just completed or not. Could be more granular later.
                    return App.data.progress.modulesCompleted[levelId]?.includes(moduleId) ? 100 : 0;
                }
            },

            // --- UI & FEEDBACK ---
            UI: {
                init() {
                    this.setTheme(App.data.settings.theme, true);
                    this.updateHeader();
                },
                updateActiveNav(page) {
                    App.DOM.els.navLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.page === page);
                    });
                },
                updateHeader() {
                    App.DOM.els.streakValue.innerText = App.data.userProfile.streak;
                    App.DOM.els.xpValue.innerText = App.data.userProfile.xp;
                    App.DOM.els.userProfileToggle.innerText = App.data.userProfile.name.charAt(0).toUpperCase();
                },
                setTheme(theme, isInitial = false) {
                    document.body.dataset.theme = theme;
                    App.DOM.els.darkModeCheckbox.checked = theme === 'dark';
                    if(!isInitial) {
                        App.data.settings.theme = theme;
                        App.DataManager.save('settings');
                        this.showToast(`Theme set to ${theme}`);
                    }
                },
                showToast(message) {
                    const toast = document.createElement('div');
                    toast.className = 'toast';
                    toast.textContent = message;
                    document.body.appendChild(toast);
                    
                    // Simple styling for toast
                    toast.style.position = 'fixed';
                    toast.style.bottom = '20px';
                    toast.style.left = '50%';
                    toast.style.transform = 'translateX(-50%)';
                    toast.style.background = 'var(--primary-color)';
                    toast.style.color = 'white';
                    toast.style.padding = '1rem 2rem';
                    toast.style.borderRadius = '8px';
                    toast.style.zIndex = '9999';
                    toast.style.opacity = '0';
                    toast.style.transition = 'opacity 0.5s ease';
                    
                    setTimeout(() => { toast.style.opacity = '1'; }, 100);
                    setTimeout(() => {
                        toast.style.opacity = '0';
                        setTimeout(() => toast.remove(), 500);
                    }, 3000);
                }
            },

            // --- AUDIO ---
            Audio: {
                speak(text) {
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'uk-UA';
                        utterance.rate = 0.9;
                        window.speechSynthesis.speak(utterance);
                    } else {
                        App.UI.showToast("Text-to-speech is not supported in your browser.");
                    }
                }
            }
        };

        // --- Start the App ---
        document.addEventListener('DOMContentLoaded', () => {
            // Bind `this` for all methods within App modules
            for (const module in App) {
                if (typeof App[module] === 'object' && App[module] !== null) {
                    for(const method in App[module]) {
                        if(typeof App[module][method] === 'function') {
                            App[module][method] = App[module][method].bind(App);
                        }
                    }
                }
            }
            App.init();
        });

    </script>
</body>
</html>
